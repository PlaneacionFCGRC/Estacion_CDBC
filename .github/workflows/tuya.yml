run: |
  python <<EOF
  import requests, time, hmac, hashlib

  client_id = "${CLIENT_ID}"
  secret = "${CLIENT_SECRET}"
  endpoint = "https://openapi.tuyaus.com"

  def sha256(data=""):
      return hashlib.sha256(data.encode()).hexdigest()

  def sign(method, path, timestamp, access_token=""):
      body_hash = sha256("")
      string_to_sign = f"{method}\n{body_hash}\n\n{path}"
      message = client_id + access_token + timestamp + string_to_sign
      return hmac.new(secret.encode(), message.encode(), hashlib.sha256).hexdigest().upper()

  # --- TOKEN ---
  path = "/v1.0/token?grant_type=1"
  t = str(int(time.time()*1000))

  headers = {
      "client_id": client_id,
      "sign": sign("GET", path, t),
      "t": t,
      "sign_method": "HMAC-SHA256"
  }

  r = requests.get(endpoint + path, headers=headers)
  print(r.text)
  data = r.json()

  if not data.get("success"):
      raise Exception(data)

  access_token = data["result"]["access_token"]

  print("TOKEN OK:", access_token)
  EOF
